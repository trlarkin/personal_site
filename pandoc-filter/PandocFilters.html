<!DOCTYPE html>
<!-- saved from url=(0031)https://pandoc.org/filters.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <title>Pandoc - Pandoc filters</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="stylesheet" href="./PandocFilters_files/site.css">
  <style>
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {  background-color: #f8f8f8; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ef2929; } /* Alert */
    code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #204a87; } /* Attribute */
    code span.bn { color: #0000cf; } /* BaseN */
    code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4e9a06; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #8f5902; font-style: italic; } /* Comment */
    code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
    code span.dt { color: #204a87; } /* DataType */
    code span.dv { color: #0000cf; } /* DecVal */
    code span.er { color: #a40000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #0000cf; } /* Float */
    code span.fu { color: #204a87; font-weight: bold; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
    code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
    code span.ot { color: #8f5902; } /* Other */
    code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
    code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
    code span.ss { color: #4e9a06; } /* SpecialString */
    code span.st { color: #4e9a06; } /* String */
    code span.va { color: #000000; } /* Variable */
    code span.vs { color: #4e9a06; } /* VerbatimString */
    code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body data-new-gr-c-s-check-loaded="14.1153.0" data-gr-ext-installed="">
  <header>
    <div id="ukraine">
      <a href="https://novaukraine.org/">Please help Ukraine!</a>
    </div>
    <div id="github-sponsors">
      <a href="https://github.com/users/jgm/sponsorship">Sponsor</a>
    </div>
    <div id="paypal">
      <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
        <input type="hidden" name="cmd" value="_s-xclick">
        <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
        ">
        <input type="image" src="./PandocFilters_files/btn_donate_SM.gif" name="submit" alt="PayPal - The safer, easier way to pay online!">
        <img alt="" style="border:0" src="./PandocFilters_files/pixel.gif" width="1" height="1">
      </form>
    </div>
    <span class="big">Pandoc</span>
    &nbsp;
    <span class="small">a universal document converter</span>
  </header>
  <nav class="navbar">
    <ul class="navbar">
      <li class="nav-item active">
        <a class="nav-link" href="https://pandoc.org/index.html">About</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://pandoc.org/installing.html">Installing</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://pandoc.org/demos.html">Demos</a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="https://pandoc.org/filters.html#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-expanded="false">
          Documentation
        </a>
        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
          <li class="nav-item"><a class="dropdown-item" href="https://pandoc.org/getting-started.html">Getting started</a></li>
          <li class="nav-item"><a class="dropdown-item" href="https://pandoc.org/MANUAL.html">User's Guide</a></li>
          <li class="nav-item"><a class="dropdown-item" href="https://pandoc.org/MANUAL.pdf">User's Guide (PDF)</a></li>
          <li class="nav-item"><a class="dropdown-item" href="https://pandoc.org/CONTRIBUTING.html">Contributing</a></li>
          <li class="nav-item"><a class="dropdown-item" href="https://pandoc.org/faqs.html">FAQ</a></li>
          <li class="nav-item"><a class="dropdown-item" href="https://pandoc.org/press.html">Press</a></li>
          <li class="nav-item"><a class="dropdown-item" href="https://pandoc.org/filters.html">Filters</a></li>
          <li class="nav-item"><a class="dropdown-item" href="https://pandoc.org/lua-filters.html">Lua filters</a></li>
          <li class="nav-item"><a class="dropdown-item" href="https://pandoc.org/custom-readers.html">Custom readers</a></li>
          <li class="nav-item"><a class="dropdown-item" href="https://pandoc.org/custom-writers.html">Custom writers</a></li>
          <li class="nav-item"><a class="dropdown-item" href="https://pandoc.org/pandoc-server.html">pandoc-server</a></li>
          <li class="nav-item"><a class="dropdown-item" href="https://pandoc.org/epub.html">Making an ebook</a></li>
          <li class="nav-item"><a class="dropdown-item" href="https://pandoc.org/org.html">Emacs Org mode support</a></li>
          <li class="nav-item"><a class="dropdown-item" href="https://pandoc.org/jats.html">JATS support</a></li>
          <li class="nav-item"><a class="dropdown-item" href="https://pandoc.org/using-the-pandoc-api.html">Using the Pandoc API</a></li>
          <li class="nav-item"><a class="dropdown-item" href="http://hackage.haskell.org/package/pandoc">API documentation</a></li>
        </ul>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://pandoc.org/help.html">Help</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://pandoc.org/extras.html">Extras</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://pandoc.org/releases.html">Releases</a>
      </li>
      <li>
      <form action="https://duckduckgo.com/" method="get" id="form-search">
	<input aria-label="Search" type="text" name="q" id="input-search">
	<input type="hidden" name="sites" value="pandoc.org">
	<button id="submit-search">Search</button>
      </form>
      </li>
    </ul>
  </nav>
  <div class="container">
    <main>
      <h1 class="title">Pandoc filters</h1>
      <section id="summary" class="level1">
      <h1><a href="https://pandoc.org/filters.html#summary" class="anchor" aria-hidden="true"></a>Summary</h1>
      <p>Pandoc provides an interface for users to write programs (known
      as filters) which act on pandoc’s AST.</p>
      <p>Pandoc consists of a set of readers and writers. When
      converting a document from one format to another, text is parsed
      by a reader into pandoc’s intermediate representation of the
      document—an “abstract syntax tree” or AST—which is then converted
      by the writer into the target format. The pandoc AST format is
      defined in the module <a href="https://hackage.haskell.org/package/pandoc-types/docs/Text-Pandoc-Definition.html"><span class="nowrap"><code>Text.Pandoc.Definition</code></span> in the
      <span class="nowrap"><code>pandoc-types</code></span>
      package</a>.</p>
      <p>A “filter” is a program that modifies the AST, between the
      reader and the writer.</p>
      <pre><code>INPUT --reader--&gt; AST --filter--&gt; AST --writer--&gt; OUTPUT</code></pre>
      <p>Pandoc supports two kinds of filters:</p>
      <ul>
      <li><p><strong>Lua filters</strong> use the Lua language to define
      transformations on the pandoc AST. They are described in a <a href="https://pandoc.org/lua-filters.html">separate document</a>.</p></li>
      <li><p><strong>JSON filters</strong>, described here, are pipes
      that read from standard input and write to standard output,
      consuming and producing a JSON representation of the pandoc
      AST:</p>
      <pre><code>                       source format
                            ↓
                         (pandoc)
                            ↓
                    JSON-formatted AST
                            ↓
                      (JSON filter)
                            ↓
                    JSON-formatted AST
                            ↓
                         (pandoc)
                            ↓
                      target format</code></pre></li>
      </ul>
      <p>Lua filters have a couple of advantages. They use a Lua
      interpreter that is embedded in pandoc, so you don’t need to have
      any external software installed. And they are usually faster than
      JSON filters. But if you wish to write your filter in a language
      other than Lua, you may prefer to use a JSON filter. JSON filters
      may be written in any programming language.</p>
      <p>You can use a JSON filter directly in a pipeline:</p>
      <pre><code>pandoc -s input.txt -t json | \
 pandoc-citeproc | \
 pandoc -s -f json -o output.html</code></pre>
      <p>But it is more convenient to use the <span class="nowrap"><code>--filter</code></span> option, which handles
      the plumbing automatically:</p>
      <pre><code>pandoc -s input.txt --filter pandoc-citeproc -o output.html</code></pre>
      <p>For a gentle introduction into writing your own filters,
      continue this guide. There’s also a <a href="https://github.com/jgm/pandoc/wiki/Pandoc-Filters">list of
      third party filters on the wiki</a>.</p>
      </section>
      <section id="a-simple-example" class="level1">
      <h1><a href="https://pandoc.org/filters.html#a-simple-example" class="anchor" aria-hidden="true"></a>A simple example</h1>
      <p>Suppose you wanted to replace all level 2+ headings in a
      markdown document with regular paragraphs, with text in italics.
      How would you go about doing this?</p>
      <p>A first thought would be to use regular expressions. Something
      like this:</p>
      <pre><code>perl -pe 's/^##+ (.*)$/\*\1\*/' source.txt</code></pre>
      <p>This should work most of the time. But don’t forget that ATX
      style headings can end with a sequence of <span class="nowrap"><code>#</code></span>s that is not part of the
      heading text:</p>
      <pre><code>## My heading ##</code></pre>
      <p>And what if your document contains a line starting with <span class="nowrap"><code>##</code></span> in an HTML comment or
      delimited code block?</p>
      <pre><code>&lt;!--
## This is just a comment
--&gt;

~~~~
### A third level heading in standard markdown
~~~~</code></pre>
      <p>We don’t want to touch <em>these</em> lines. Moreover, what
      about Setext style second-level heading?</p>
      <pre><code>A heading
---------</code></pre>
      <p>We need to handle those too. Finally, can we be sure that
      adding asterisks to each side of our string will put it in
      italics? What if the string already contains asterisks around it?
      Then we’ll end up with bold text, which is not what we want. And
      what if it contains a regular unescaped asterisk?</p>
      <p>How would you modify your regular expression to handle these
      cases? It would be hairy, to say the least.</p>
      <p>A better approach is to let pandoc handle the parsing, and then
      modify the AST before the document is written. For this, we can
      use a filter.</p>
      <p>To see what sort of AST is produced when pandoc parses our
      text, we can use pandoc’s <span class="nowrap"><code>native</code></span> output format:</p>
      <pre><code>% cat test.txt
## my heading

text with *italics*
% pandoc -s -t native test.txt
Pandoc (Meta {unMeta = fromList []})
[Header 2 ("my-heading",[],[]) [Str "My",Space,Str "heading"]
, Para [Str "text",Space,Str "with",Space,Emph [Str "italics"]] ]</code></pre>
      <p>A <span class="nowrap"><code>Pandoc</code></span> document
      consists of a <span class="nowrap"><code>Meta</code></span> block
      (containing metadata like title, authors, and date) and a list of
      <span class="nowrap"><code>Block</code></span> elements. In this
      case, we have two <span class="nowrap"><code>Block</code></span>s,
      a <span class="nowrap"><code>Header</code></span> and a <span class="nowrap"><code>Para</code></span>. Each has as its content a
      list of <span class="nowrap"><code>Inline</code></span> elements.
      For more details on the pandoc AST, see the <a href="https://hackage.haskell.org/package/pandoc-types">haddock
      documentation for <span class="nowrap"><code>Text.Pandoc.Definition</code></span></a>.</p>
      <p>We can use Haskell to create a JSON filter that transforms this
      AST, replacing each <span class="nowrap"><code>Header</code></span> block with level &gt;= 2
      with a <span class="nowrap"><code>Para</code></span> with its
      contents wrapped inside an <span class="nowrap"><code>Emph</code></span> inline:</p>
      <div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb10-1"><a href="https://pandoc.org/filters.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#!/usr/bin/env runhaskell</span></span>
<span id="cb10-2"><a href="https://pandoc.org/filters.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- behead.hs</span></span>
<span id="cb10-3"><a href="https://pandoc.org/filters.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.Pandoc.JSON</span></span>
<span id="cb10-4"><a href="https://pandoc.org/filters.html#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="https://pandoc.org/filters.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb10-6"><a href="https://pandoc.org/filters.html#cb10-6" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> toJSONFilter behead</span>
<span id="cb10-7"><a href="https://pandoc.org/filters.html#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="https://pandoc.org/filters.html#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="ot">behead ::</span> <span class="dt">Block</span> <span class="ot">-&gt;</span> <span class="dt">Block</span></span>
<span id="cb10-9"><a href="https://pandoc.org/filters.html#cb10-9" aria-hidden="true" tabindex="-1"></a>behead (<span class="dt">Header</span> n _ xs) <span class="op">|</span> n <span class="op">&gt;=</span> <span class="dv">2</span> <span class="ot">=</span> <span class="dt">Para</span> [<span class="dt">Emph</span> xs]</span>
<span id="cb10-10"><a href="https://pandoc.org/filters.html#cb10-10" aria-hidden="true" tabindex="-1"></a>behead x <span class="ot">=</span> x</span></code></pre></div>
      <p>The <span class="nowrap"><code>toJSONFilter</code></span>
      function does two things. First, it lifts the <span class="nowrap"><code>behead</code></span> function (which maps
      <span class="nowrap"><code>Block -&gt; Block</code></span>) onto a
      transformation of the entire <span class="nowrap"><code>Pandoc</code></span> AST, walking the AST and
      transforming each block. Second, it wraps this <span class="nowrap"><code>Pandoc -&gt; Pandoc</code></span>
      transformation with the necessary JSON serialization and
      deserialization, producing an executable that consumes JSON from
      stdin and produces JSON to stdout.</p>
      <p>To use the filter, make it executable:</p>
      <pre><code>chmod +x behead.hs</code></pre>
      <p>and then</p>
      <pre><code>pandoc -f SOURCEFORMAT -t TARGETFORMAT --filter ./behead.hs</code></pre>
      <p>(It is also necessary that <span class="nowrap"><code>pandoc-types</code></span> be installed in
      the local package repository. To do this using cabal-install,
      <span class="nowrap"><code>cabal v2-update &amp;&amp; cabal v2-install --lib pandoc-types --package-env .</code></span>.)</p>
      <p>Alternatively, we could compile the filter:</p>
      <pre><code>ghc -package-env=default --make behead.hs
pandoc -f SOURCEFORMAT -t TARGETFORMAT --filter ./behead</code></pre>
      <p>Note that if the filter is placed in the system PATH, then the
      initial <span class="nowrap"><code>./</code></span> is not needed.
      Note also that the command line can include multiple instances of
      <span class="nowrap"><code>--filter</code></span>: the filters
      will be applied in sequence.</p>
      </section>
      <section id="latex-for-wordpress" class="level1">
      <h1><a href="https://pandoc.org/filters.html#latex-for-wordpress" class="anchor" aria-hidden="true"></a>LaTeX for WordPress</h1>
      <p>Another easy example. WordPress blogs require a special format
      for LaTeX math. Instead of <span class="nowrap"><code>$e=mc^2$</code></span>, you need: <span class="nowrap"><code>$LaTeX e=mc^2$</code></span>. How can we
      convert a markdown document accordingly?</p>
      <p>Again, it’s difficult to do the job reliably with regexes. A
      <span class="nowrap"><code>$</code></span> might be a regular
      currency indicator, or it might occur in a comment or code block
      or inline code span. We just want to find the <span class="nowrap"><code>$</code></span>s that begin LaTeX math. If
      only we had a parser…</p>
      <p>We do. Pandoc already extracts LaTeX math, so:</p>
      <div class="sourceCode" id="cb14"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb14-1"><a href="https://pandoc.org/filters.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#!/usr/bin/env runhaskell</span></span>
<span id="cb14-2"><a href="https://pandoc.org/filters.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- wordpressify.hs</span></span>
<span id="cb14-3"><a href="https://pandoc.org/filters.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.Pandoc.JSON</span></span>
<span id="cb14-4"><a href="https://pandoc.org/filters.html#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="https://pandoc.org/filters.html#cb14-5" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> toJSONFilter wordpressify</span>
<span id="cb14-6"><a href="https://pandoc.org/filters.html#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span> wordpressify (<span class="dt">Math</span> x y) <span class="ot">=</span> <span class="dt">Math</span> x (<span class="st">"LaTeX "</span> <span class="op">++</span> y)</span>
<span id="cb14-7"><a href="https://pandoc.org/filters.html#cb14-7" aria-hidden="true" tabindex="-1"></a>        wordpressify x <span class="ot">=</span> x</span></code></pre></div>
      <p>Mission accomplished. (I’ve omitted type signatures here, just
      to show it can be done.)</p>
      </section>
      <section id="but-i-dont-want-to-learn-haskell" class="level1">
      <h1><a href="https://pandoc.org/filters.html#but-i-dont-want-to-learn-haskell" class="anchor" aria-hidden="true"></a>But I don’t want to learn Haskell!</h1>
      <p>While it’s easiest to write pandoc filters in Haskell, it is
      fairly easy to write them in python using the <span class="nowrap"><code>pandocfilters</code></span> package. The
      package is in PyPI and can be installed using <span class="nowrap"><code>pip install pandocfilters</code></span> or
      <span class="nowrap"><code>easy_install pandocfilters</code></span>.</p>
      <p>Here’s our “beheading” filter in python:</p>
      <div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="https://pandoc.org/filters.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env python</span></span>
<span id="cb15-2"><a href="https://pandoc.org/filters.html#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="https://pandoc.org/filters.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb15-4"><a href="https://pandoc.org/filters.html#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">Pandoc filter to convert all level 2+ headings to paragraphs with</span></span>
<span id="cb15-5"><a href="https://pandoc.org/filters.html#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">emphasized text.</span></span>
<span id="cb15-6"><a href="https://pandoc.org/filters.html#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb15-7"><a href="https://pandoc.org/filters.html#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="https://pandoc.org/filters.html#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pandocfilters <span class="im">import</span> toJSONFilter, Emph, Para</span>
<span id="cb15-9"><a href="https://pandoc.org/filters.html#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="https://pandoc.org/filters.html#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> behead(key, value, <span class="bu">format</span>, meta):</span>
<span id="cb15-11"><a href="https://pandoc.org/filters.html#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> key <span class="op">==</span> <span class="st">'Header'</span> <span class="kw">and</span> value[<span class="dv">0</span>] <span class="op">&gt;=</span> <span class="dv">2</span>:</span>
<span id="cb15-12"><a href="https://pandoc.org/filters.html#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Para([Emph(value[<span class="dv">2</span>])])</span>
<span id="cb15-13"><a href="https://pandoc.org/filters.html#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="https://pandoc.org/filters.html#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb15-15"><a href="https://pandoc.org/filters.html#cb15-15" aria-hidden="true" tabindex="-1"></a>  toJSONFilter(behead)</span></code></pre></div>
      <p><span class="nowrap"><code>toJSONFilter(behead)</code></span>
      walks the AST and applies the <span class="nowrap"><code>behead</code></span> action to each element.
      If <span class="nowrap"><code>behead</code></span> returns
      nothing, the node is unchanged; if it returns an object, the node
      is replaced; if it returns a list, the new list is spliced in.</p>
      <p>Note that, although these parameters are not used in this
      example, <span class="nowrap"><code>format</code></span> provides
      access to the target format, and <span class="nowrap"><code>meta</code></span> provides access to the
      document’s metadata.</p>
      <p>There are many examples of python filters in <a href="https://github.com/jgm/pandocfilters">the pandocfilters
      repository</a>.</p>
      <p>For a more Pythonic alternative to pandocfilters, see the <a href="https://pypi.org/project/panflute">panflute</a> library.
      Don’t like Python? There are also ports of pandocfilters in</p>
      <ul>
      <li><a href="https://github.com/vinai/pandocfilters-php">PHP</a>,</li>
      <li><a href="https://metacpan.org/pod/Pandoc::Filter">perl</a>,</li>
      <li>TypeScript/JavaScript via Node.js
      <ul>
      <li><a href="https://github.com/mvhenderson/pandoc-filter-node">pandoc-filter</a>,</li>
      <li><a href="https://github.com/mu-io/node-pandoc-filter">node-pandoc-filter</a>,</li>
      </ul></li>
      <li><a href="https://github.com/dfrommi/groovy-pandoc">Groovy</a>,
      and</li>
      <li><a href="https://heerdebeer.org/Software/markdown/paru/">Ruby</a>.</li>
      </ul>
      <p>Starting with pandoc 2.0, pandoc includes built-in support for
      writing filters in lua. The lua interpreter is built in to pandoc,
      so a lua filter does not require any additional software to run.
      See the <a href="https://pandoc.org/lua-filters.html">documentation on lua
      filters</a>.</p>
      </section>
      <section id="include-files" class="level1">
      <h1><a href="https://pandoc.org/filters.html#include-files" class="anchor" aria-hidden="true"></a>Include files</h1>
      <p>So none of our transforms have involved IO. How about a script
      that reads a markdown document, finds all the inline code blocks
      with attribute <span class="nowrap"><code>include</code></span>,
      and replaces their contents with the contents of the file
      given?</p>
      <div class="sourceCode" id="cb16"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb16-1"><a href="https://pandoc.org/filters.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#!/usr/bin/env runhaskell</span></span>
<span id="cb16-2"><a href="https://pandoc.org/filters.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- includes.hs</span></span>
<span id="cb16-3"><a href="https://pandoc.org/filters.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.Pandoc.JSON</span></span>
<span id="cb16-4"><a href="https://pandoc.org/filters.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Text.IO</span> <span class="kw">as</span> <span class="dt">TIO</span></span>
<span id="cb16-5"><a href="https://pandoc.org/filters.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Text</span> <span class="kw">as</span> <span class="dt">T</span></span>
<span id="cb16-6"><a href="https://pandoc.org/filters.html#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="https://pandoc.org/filters.html#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="ot">doInclude ::</span> <span class="dt">Block</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> <span class="dt">Block</span></span>
<span id="cb16-8"><a href="https://pandoc.org/filters.html#cb16-8" aria-hidden="true" tabindex="-1"></a>doInclude cb<span class="op">@</span>(<span class="dt">CodeBlock</span> (<span class="fu">id</span>, classes, namevals) contents) <span class="ot">=</span></span>
<span id="cb16-9"><a href="https://pandoc.org/filters.html#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">case</span> <span class="fu">lookup</span> (T.pack <span class="st">"include"</span>) namevals <span class="kw">of</span></span>
<span id="cb16-10"><a href="https://pandoc.org/filters.html#cb16-10" aria-hidden="true" tabindex="-1"></a>       <span class="dt">Just</span> f     <span class="ot">-&gt;</span> <span class="dt">CodeBlock</span> (<span class="fu">id</span>, classes, namevals) <span class="op">&lt;$&gt;</span></span>
<span id="cb16-11"><a href="https://pandoc.org/filters.html#cb16-11" aria-hidden="true" tabindex="-1"></a>                      TIO.readFile (T.unpack f)</span>
<span id="cb16-12"><a href="https://pandoc.org/filters.html#cb16-12" aria-hidden="true" tabindex="-1"></a>       <span class="dt">Nothing</span>    <span class="ot">-&gt;</span> <span class="fu">return</span> cb</span>
<span id="cb16-13"><a href="https://pandoc.org/filters.html#cb16-13" aria-hidden="true" tabindex="-1"></a>doInclude x <span class="ot">=</span> <span class="fu">return</span> x</span>
<span id="cb16-14"><a href="https://pandoc.org/filters.html#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="https://pandoc.org/filters.html#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb16-16"><a href="https://pandoc.org/filters.html#cb16-16" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> toJSONFilter doInclude</span></code></pre></div>
      <p>Try this on the following:</p>
      <pre><code>Here's the pandoc README:

~~~~ {include="README"}
this will be replaced by contents of README
~~~~</code></pre>
      </section>
      <section id="removing-links" class="level1">
      <h1><a href="https://pandoc.org/filters.html#removing-links" class="anchor" aria-hidden="true"></a>Removing links</h1>
      <p>What if we want to remove every link from a document, retaining
      the link’s text?</p>
      <div class="sourceCode" id="cb18"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb18-1"><a href="https://pandoc.org/filters.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#!/usr/bin/env runhaskell</span></span>
<span id="cb18-2"><a href="https://pandoc.org/filters.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- delink.hs</span></span>
<span id="cb18-3"><a href="https://pandoc.org/filters.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.Pandoc.JSON</span></span>
<span id="cb18-4"><a href="https://pandoc.org/filters.html#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="https://pandoc.org/filters.html#cb18-5" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> toJSONFilter delink</span>
<span id="cb18-6"><a href="https://pandoc.org/filters.html#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="https://pandoc.org/filters.html#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="ot">delink ::</span> <span class="dt">Inline</span> <span class="ot">-&gt;</span> [<span class="dt">Inline</span>]</span>
<span id="cb18-8"><a href="https://pandoc.org/filters.html#cb18-8" aria-hidden="true" tabindex="-1"></a>delink (<span class="dt">Link</span> _ txt _) <span class="ot">=</span> txt</span>
<span id="cb18-9"><a href="https://pandoc.org/filters.html#cb18-9" aria-hidden="true" tabindex="-1"></a>delink x              <span class="ot">=</span> [x]</span></code></pre></div>
      <p>Note that <span class="nowrap"><code>delink</code></span> can’t
      be a function of type <span class="nowrap"><code>Inline -&gt; Inline</code></span>, because
      the thing we want to replace the link with is not a single <span class="nowrap"><code>Inline</code></span> element, but a list of
      them. So we make <span class="nowrap"><code>delink</code></span> a
      function from an <span class="nowrap"><code>Inline</code></span>
      element to a list of <span class="nowrap"><code>Inline</code></span> elements. <span class="nowrap"><code>toJSONFilter</code></span> can still lift
      this function to a transformation of type <span class="nowrap"><code>Pandoc -&gt; Pandoc</code></span>.</p>
      </section>
      <section id="a-filter-for-ruby-text" class="level1">
      <h1><a href="https://pandoc.org/filters.html#a-filter-for-ruby-text" class="anchor" aria-hidden="true"></a>A filter for ruby text</h1>
      <p>Finally, here’s a nice real-world example, developed on the <a href="https://groups.google.com/group/pandoc-discuss/browse_thread/thread/7baea325565878c8">pandoc-discuss</a>
      list. Qubyte wrote:</p>
      <blockquote>
      <p>I’m interested in using pandoc to turn my markdown notes on
      Japanese into nicely set HTML and (Xe)LaTeX. With HTML5, ruby
      (typically used to phonetically read chinese characters by placing
      text above or to the side) is standard, and support from browsers
      is emerging (Webkit based browsers appear to fully support it).
      For those browsers that don’t support it yet (notably Firefox) the
      feature falls back in a nice way by placing the phonetic reading
      inside brackets to the side of each Chinese character, which is
      suitable for other output formats too. As for (Xe)LaTeX, ruby is
      not an issue.</p>
      <p>At the moment, I use inline HTML to achieve the result when the
      conversion is to HTML, but it’s ugly and uses a lot of keystrokes,
      for example</p>
      <div class="sourceCode" id="cb19"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb19-1"><a href="https://pandoc.org/filters.html#cb19-1" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">ruby</span>&gt;ご&lt;<span class="kw">rt</span>&gt;&lt;/<span class="kw">rt</span>&gt;飯&lt;<span class="kw">rp</span>&gt;（&lt;/<span class="kw">rp</span>&gt;&lt;<span class="kw">rt</span>&gt;はん&lt;/<span class="kw">rt</span>&gt;&lt;<span class="kw">rp</span>&gt;）&lt;/<span class="kw">rp</span>&gt;&lt;/<span class="kw">ruby</span>&gt;</span></code></pre></div>
      <p>sets ご飯 “gohan” with “han” spelt phonetically above the
      second character, or to the right of it in brackets if the browser
      does not support ruby. I’d like to have something more like</p>
      <pre><code>r[はん](飯)</code></pre>
      <p>or any keystroke saving convention would be welcome.</p>
      </blockquote>
      <p>We came up with the following script, which uses the convention
      that a markdown link with a URL beginning with a hyphen is
      interpreted as ruby:</p>
      <pre><code>[はん](-飯)</code></pre>
      <div class="sourceCode" id="cb22"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb22-1"><a href="https://pandoc.org/filters.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></span>
<span id="cb22-2"><a href="https://pandoc.org/filters.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- handleruby.hs</span></span>
<span id="cb22-3"><a href="https://pandoc.org/filters.html#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.Pandoc.JSON</span></span>
<span id="cb22-4"><a href="https://pandoc.org/filters.html#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">System.Environment</span> (getArgs)</span>
<span id="cb22-5"><a href="https://pandoc.org/filters.html#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.Text</span> <span class="kw">as</span> <span class="dt">T</span></span>
<span id="cb22-6"><a href="https://pandoc.org/filters.html#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="https://pandoc.org/filters.html#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="ot">handleRuby ::</span> <span class="dt">Maybe</span> <span class="dt">Format</span> <span class="ot">-&gt;</span> <span class="dt">Inline</span> <span class="ot">-&gt;</span> <span class="dt">Inline</span></span>
<span id="cb22-8"><a href="https://pandoc.org/filters.html#cb22-8" aria-hidden="true" tabindex="-1"></a>handleRuby (<span class="dt">Just</span> format) x<span class="op">@</span>(<span class="dt">Link</span> attr [<span class="dt">Str</span> ruby] (src,_)) <span class="ot">=</span></span>
<span id="cb22-9"><a href="https://pandoc.org/filters.html#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">case</span> T.uncons src <span class="kw">of</span></span>
<span id="cb22-10"><a href="https://pandoc.org/filters.html#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Just</span> (<span class="ch">'-'</span>,kanji)</span>
<span id="cb22-11"><a href="https://pandoc.org/filters.html#cb22-11" aria-hidden="true" tabindex="-1"></a>      <span class="op">|</span> format <span class="op">==</span> <span class="dt">Format</span> <span class="st">"html"</span> <span class="ot">-&gt;</span> <span class="dt">RawInline</span> format <span class="op">$</span></span>
<span id="cb22-12"><a href="https://pandoc.org/filters.html#cb22-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;ruby&gt;"</span> <span class="op">&lt;&gt;</span> kanji <span class="op">&lt;&gt;</span> <span class="st">"&lt;rp&gt;(&lt;/rp&gt;&lt;rt&gt;"</span> <span class="op">&lt;&gt;</span> ruby <span class="op">&lt;&gt;</span></span>
<span id="cb22-13"><a href="https://pandoc.org/filters.html#cb22-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;/rt&gt;&lt;rp&gt;)&lt;/rp&gt;&lt;/ruby&gt;"</span></span>
<span id="cb22-14"><a href="https://pandoc.org/filters.html#cb22-14" aria-hidden="true" tabindex="-1"></a>      <span class="op">|</span> format <span class="op">==</span> <span class="dt">Format</span> <span class="st">"latex"</span> <span class="ot">-&gt;</span> <span class="dt">RawInline</span> format <span class="op">$</span></span>
<span id="cb22-15"><a href="https://pandoc.org/filters.html#cb22-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"\\ruby{"</span> <span class="op">&lt;&gt;</span> kanji <span class="op">&lt;&gt;</span> <span class="st">"}{"</span> <span class="op">&lt;&gt;</span> ruby <span class="op">&lt;&gt;</span> <span class="st">"}"</span></span>
<span id="cb22-16"><a href="https://pandoc.org/filters.html#cb22-16" aria-hidden="true" tabindex="-1"></a>      <span class="op">|</span> <span class="fu">otherwise</span> <span class="ot">-&gt;</span> <span class="dt">Str</span> ruby</span>
<span id="cb22-17"><a href="https://pandoc.org/filters.html#cb22-17" aria-hidden="true" tabindex="-1"></a>    _ <span class="ot">-&gt;</span> x</span>
<span id="cb22-18"><a href="https://pandoc.org/filters.html#cb22-18" aria-hidden="true" tabindex="-1"></a>handleRuby _ x <span class="ot">=</span> x</span>
<span id="cb22-19"><a href="https://pandoc.org/filters.html#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="https://pandoc.org/filters.html#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb22-21"><a href="https://pandoc.org/filters.html#cb22-21" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> toJSONFilter handleRuby</span></code></pre></div>
      <p>Note that, when a script is called using <span class="nowrap"><code>--filter</code></span>, pandoc passes it the
      target format as the first argument. When a function’s first
      argument is of type <span class="nowrap"><code>Maybe Format</code></span>, <span class="nowrap"><code>toJSONFilter</code></span> will automatically
      assign it <span class="nowrap"><code>Just</code></span> the target
      format or <span class="nowrap"><code>Nothing</code></span>.</p>
      <p>We compile our script:</p>
      <pre><code># first, make sure pandoc-types is installed:
cabal install --lib pandoc-types --package-env .
ghc --make handleRuby</code></pre>
      <p>Then run it:</p>
      <pre><code>% pandoc -F ./handleRuby -t html
[はん](-飯)
^D
&lt;p&gt;&lt;ruby&gt;飯&lt;rp&gt;(&lt;/rp&gt;&lt;rt&gt;はん&lt;/rt&gt;&lt;rp&gt;)&lt;/rp&gt;&lt;/ruby&gt;&lt;/p&gt;
% pandoc -F ./handleRuby -t latex
[はん](-飯)
^D
\ruby{飯}{はん}</code></pre>
      <p>Note: to use this to generate PDFs via LaTeX, you’ll need to
      use <span class="nowrap"><code>--pdf-engine=xelatex</code></span>,
      specify a <span class="nowrap"><code>mainfont</code></span> that
      has the Japanese characters (e.g.&nbsp;“<a href="https://fonts.google.com/noto/specimen/Noto+Sans+JP">Noto
      Sans CJK JP</a>”), and add <span class="nowrap"><code>\usepackage{ruby}</code></span> to your
      template or header-includes.</p>
      </section>
      <section id="exercises" class="level1">
      <h1><a href="https://pandoc.org/filters.html#exercises" class="anchor" aria-hidden="true"></a>Exercises</h1>
      <ol type="1">
      <li><p>Put all the regular text in a markdown document in ALL CAPS
      (without touching text in URLs or link titles).</p></li>
      <li><p>Remove all horizontal rules from a document.</p></li>
      <li><p>Renumber all enumerated lists with roman numerals.</p></li>
      <li><p>Replace each delimited code block with class <span class="nowrap"><code>dot</code></span> with an image generated by
      running <span class="nowrap"><code>dot -Tpng</code></span> (from
      graphviz) on the contents of the code block.</p></li>
      <li><p>Find all code blocks with class <span class="nowrap"><code>python</code></span> and run them using the
      python interpreter, printing the results to the console.</p></li>
      </ol>
      </section>
      <section id="technical-details-of-json-filters" class="level1">
      <h1><a href="https://pandoc.org/filters.html#technical-details-of-json-filters" class="anchor" aria-hidden="true"></a>Technical details of JSON filters</h1>
      <p>A JSON filter is any program which can consume and produce a
      valid pandoc JSON document representation. This section describes
      the technical details surrounding the invocation of filters.</p>
      <section id="arguments" class="level2">
      <h2><a href="https://pandoc.org/filters.html#arguments" class="anchor" aria-hidden="true"></a>Arguments</h2>
      <p>The program will always be called with the target format as the
      only argument. A pandoc invocation like</p>
      <pre><code>pandoc --filter demo --to=html</code></pre>
      <p>will cause pandoc to call the program <span class="nowrap"><code>demo</code></span> with argument <span class="nowrap"><code>html</code></span>.</p>
      </section>
      <section id="environment-variables" class="level2">
      <h2><a href="https://pandoc.org/filters.html#environment-variables" class="anchor" aria-hidden="true"></a>Environment variables</h2>
      <p>Pandoc sets additional environment variables before calling a
      filter.</p>
      <dl>
      <dt><span class="nowrap"><code>PANDOC_VERSION</code></span></dt>
      <dd>
      The version of the pandoc binary used to process the document.
      Example: <span class="nowrap"><code>2.11.1</code></span>.
      </dd>
      <dt><span class="nowrap"><code>PANDOC_READER_OPTIONS</code></span></dt>
      <dd>
      <p>JSON object representation of the options passed to the input
      parser.</p>
      <p>Object fields:</p>
      <dl>
      <dt><span class="nowrap"><code>abbreviations</code></span></dt>
      <dd>
      set of known abbreviations (array of strings).
      </dd>
      <dt><span class="nowrap"><code>columns</code></span></dt>
      <dd>
      number of columns in terminal; an integer.
      </dd>
      <dt><span class="nowrap"><code>default-image-extension</code></span></dt>
      <dd>
      default extension for images; a string.
      </dd>
      <dt><span class="nowrap"><code>extensions</code></span></dt>
      <dd>
      integer representation of the syntax extensions bit field.
      </dd>
      <dt><span class="nowrap"><code>indented-code-classes</code></span></dt>
      <dd>
      default classes for indented code blocks; array of strings.
      </dd>
      <dt><span class="nowrap"><code>standalone</code></span></dt>
      <dd>
      whether the input was a standalone document with header; either
      <span class="nowrap"><code>true</code></span> or <span class="nowrap"><code>false</code></span>.
      </dd>
      <dt><span class="nowrap"><code>strip-comments</code></span></dt>
      <dd>
      HTML comments are stripped instead of parsed as raw HTML; either
      <span class="nowrap"><code>true</code></span> or <span class="nowrap"><code>false</code></span>.
      </dd>
      <dt><span class="nowrap"><code>tab-stop</code></span></dt>
      <dd>
      width (i.e.&nbsp;equivalent number of spaces) of tab stops; integer.
      </dd>
      <dt><span class="nowrap"><code>track-changes</code></span></dt>
      <dd>
      track changes setting for docx; one of <span class="nowrap"><code>"accept-changes"</code></span>, <span class="nowrap"><code>"reject-changes"</code></span>, and <span class="nowrap"><code>"all-changes"</code></span>.
      </dd>
      </dl>
      </dd>
      </dl>
      </section>
      <section id="supported-interpreters" class="level2">
      <h2><a href="https://pandoc.org/filters.html#supported-interpreters" class="anchor" aria-hidden="true"></a>Supported interpreters</h2>
      <p>Files passed to the <span class="nowrap"><code>--filter</code></span>/<span class="nowrap"><code>-F</code></span> parameter are expected to be
      executable. However, if the executable bit is not set, then pandoc
      tries to guess a suitable interpreter from the file extension.</p>
      <table>
      <thead>
      <tr class="header">
      <th style="text-align: left;">file extension</th>
      <th style="text-align: left;">interpreter</th>
      </tr>
      </thead>
      <tbody>
      <tr class="odd">
      <td style="text-align: left;">.py</td>
      <td style="text-align: left;"><span class="nowrap"><code>python</code></span></td>
      </tr>
      <tr class="even">
      <td style="text-align: left;">.hs</td>
      <td style="text-align: left;"><span class="nowrap"><code>runhaskell</code></span></td>
      </tr>
      <tr class="odd">
      <td style="text-align: left;">.pl</td>
      <td style="text-align: left;"><span class="nowrap"><code>perl</code></span></td>
      </tr>
      <tr class="even">
      <td style="text-align: left;">.rb</td>
      <td style="text-align: left;"><span class="nowrap"><code>ruby</code></span></td>
      </tr>
      <tr class="odd">
      <td style="text-align: left;">.php</td>
      <td style="text-align: left;"><span class="nowrap"><code>php</code></span></td>
      </tr>
      <tr class="even">
      <td style="text-align: left;">.js</td>
      <td style="text-align: left;"><span class="nowrap"><code>node</code></span></td>
      </tr>
      <tr class="odd">
      <td style="text-align: left;">.r</td>
      <td style="text-align: left;"><span class="nowrap"><code>Rscript</code></span></td>
      </tr>
      </tbody>
      </table>
      </section>
      </section>
    </main>
    <div id="sidebar">
      <div id="toc">
        <ul>
        <li><a href="https://pandoc.org/filters.html#summary" id="toc-summary">Summary</a></li>
        <li><a href="https://pandoc.org/filters.html#a-simple-example" id="toc-a-simple-example">A
        simple example</a></li>
        <li><a href="https://pandoc.org/filters.html#latex-for-wordpress" id="toc-latex-for-wordpress">LaTeX for WordPress</a></li>
        <li><a href="https://pandoc.org/filters.html#but-i-dont-want-to-learn-haskell" id="toc-but-i-dont-want-to-learn-haskell">But I don’t want to
        learn Haskell!</a></li>
        <li><a href="https://pandoc.org/filters.html#include-files" id="toc-include-files">Include
        files</a></li>
        <li><a href="https://pandoc.org/filters.html#removing-links" id="toc-removing-links">Removing
        links</a></li>
        <li><a href="https://pandoc.org/filters.html#a-filter-for-ruby-text" id="toc-a-filter-for-ruby-text">A filter for ruby text</a></li>
        <li><a href="https://pandoc.org/filters.html#exercises" id="toc-exercises">Exercises</a></li>
        <li><a href="https://pandoc.org/filters.html#technical-details-of-json-filters" id="toc-technical-details-of-json-filters">Technical details of
        JSON filters</a>
        <ul style="display: none;">
        <li><a href="https://pandoc.org/filters.html#arguments" id="toc-arguments">Arguments</a></li>
        <li><a href="https://pandoc.org/filters.html#environment-variables" id="toc-environment-variables">Environment variables</a></li>
        <li><a href="https://pandoc.org/filters.html#supported-interpreters" id="toc-supported-interpreters">Supported interpreters</a></li>
        </ul><span class="toggle">▸</span></li>
        </ul>
      </div>
    </div>
    <!-- Vertically centered scrollable modal -->
    <div id="search-results" class="modal scrollable" tabindex="-1">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
        <span class="modal-title">Search results</span>
       </div>
      <div id="search-data" class="modal-body">
      </div>
    </div>
  </div>
  <script src="./PandocFilters_files/site.js.download"></script>
  <script src="./PandocFilters_files/lunr.js.download" defer=""></script>
  <script src="./PandocFilters_files/index.js.download" defer=""></script>


</body><grammarly-desktop-integration data-grammarly-shadow-root="true"><template shadowrootmode="open"><style>
      div.grammarly-desktop-integration {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select:none;
        user-select:none;
      }

      div.grammarly-desktop-integration:before {
        content: attr(data-content);
      }
    </style><div aria-label="grammarly-integration" role="group" tabindex="-1" class="grammarly-desktop-integration" data-content="{&quot;mode&quot;:&quot;full&quot;,&quot;isActive&quot;:true,&quot;isUserDisabled&quot;:false}"></div></template></grammarly-desktop-integration></html>